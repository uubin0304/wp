<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MyShort - ë‹¨ì¶• URL ì„œë¹„ìŠ¤</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
         background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
         min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .container{background:#fff;padding:40px;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1);
               max-width:560px;width:100%;text-align:center}
    .logo{font-size:2.3em;font-weight:800;background:linear-gradient(135deg,#667eea,#764ba2);
          -webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px}
    .subtitle{color:#666;margin-bottom:22px;font-size:1.05em}
    .url-input{width:100%;padding:15px 20px;border:2px solid #e1e5e9;border-radius:50px;font-size:16px;
               outline:none;transition:.2s;margin-bottom:12px}
    .url-input:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.12)}
    .shorten-btn{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:0;padding:14px 28px;
                 border-radius:50px;font-size:16px;font-weight:700;cursor:pointer;transition:.2s;width:100%}
    .shorten-btn:hover{transform:translateY(-1.5px);box-shadow:0 10px 20px rgba(102,126,234,.28)}
    .shorten-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
    .error{color:#dc3545;margin-top:8px;font-size:14px;min-height:20px}
    .result{margin-top:22px;padding:18px;background:#f8f9fa;border-radius:15px;display:none}
    .result.show{display:block;animation:fade .25s ease}
    @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .short-url{background:#fff;padding:12px;border-radius:10px;border:2px solid #e1e5e9;margin:12px 0;
               font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:15px;
               word-break:break-all;display:flex;gap:10px;align-items:center;justify-content:space-between}
    .copy-btn{background:#28a745;color:#fff;border:0;padding:8px 14px;border-radius:8px;cursor:pointer;font-size:14px}
    .copy-btn:hover{background:#218838}.copy-btn.copied{background:#6c757d}
    .stats{margin-top:22px;padding:18px;background:#f8f9fa;border-radius:15px;text-align:left}
    .stats h3{margin-bottom:10px;color:#333}
    .url-item{background:#fff;padding:10px;border-radius:8px;margin-bottom:10px;border:1px solid #e1e5e9}
    .url-item .original{font-size:12px;color:#666;word-break:break-all;margin-bottom:5px}
    .url-item .short{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-weight:700;color:#667eea}
    .url-item .clicks{font-size:12px;color:#28a745;float:right}
    .tools{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tool-btn{background:#2a3040;color:#e6edf3;border:0;border-radius:8px;padding:8px 10px;cursor:pointer;font-size:12px}
    @media (max-width:480px){
      .container{padding:22px}.logo{font-size:2em}
      .short-url{flex-direction:column;align-items:stretch}
      .copy-btn{width:100%}
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <div class="logo">MyShort</div>
    <div class="subtitle">ê¸´ URLì„ ì§§ê³  ê¹”ë”í•˜ê²Œ ë§Œë“¤ì–´ë³´ì„¸ìš”</div>

    <div class="url-form">
      <input type="url" class="url-input" id="urlInput" placeholder="ë‹¨ì¶•í•  URLì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: https://example.com)"/>
      <button class="shorten-btn" id="shortenBtn">ë‹¨ì¶• URL ë§Œë“¤ê¸°</button>
      <div class="error" id="errorMsg"></div>
    </div>

    <div class="result" id="result">
      <h3>ë‹¨ì¶• URLì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰</h3>
      <div class="short-url">
        <span id="shortUrl"></span>
        <button class="copy-btn" id="copyBtn">ë³µì‚¬</button>
      </div>
      <p style="color:#555">ì´ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ì›ë³¸ URLë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="stats">
      <h3>ìƒì„±ëœ ë‹¨ì¶• URL ëª©ë¡</h3>
      <div class="tools">
        <button class="tool-btn" id="exportBtn">ë°±ì—…(JSON) ë‚´ë³´ë‚´ê¸°</button>
        <button class="tool-btn" id="importBtn">ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="tool-btn" id="clearBtn">ì „ì²´ ì‚­ì œ</button>
      </div>
      <div id="urlList" style="margin-top:10px">
        <p style="text-align:center;color:#999">ì•„ì§ ìƒì„±ëœ ë‹¨ì¶• URLì´ ì—†ìŠµë‹ˆë‹¤</p>
      </div>
    </div>
  </div>

  <script>
    // ---- ìœ í‹¸ ----
    const $ = (id)=>document.getElementById(id);
    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));

    // í”„ë¡œì íŠ¸/ìœ ì € í˜ì´ì§€ ëª¨ë‘ì—ì„œ ì •ìƒ ë™ì‘í•˜ë„ë¡ base URL ê³„ì‚°
    function getBaseUrl(){
      // /index.html ì´ ìˆìœ¼ë©´ ì œê±°, ë§ˆì§€ë§‰ì— ìŠ¬ë˜ì‹œ ì—†ìŒ
      const path = location.pathname.replace(/index\.html$/,'').replace(/\/$/,'');
      return location.origin + path;
    }

    function isValidUrl(u){
      try{ const x = new URL(u); return x.protocol==='http:'||x.protocol==='https:' }catch{ return false }
    }

    function randomCode(len=6){
      const set='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let out=''; for (let i=0;i<len;i++) out+=set[Math.floor(Math.random()*set.length)];
      return out;
    }

    function truncate(u, n){ return u.length>n ? u.slice(0,n)+'â€¦' : u; }

    // ---- ì•± ----
    class URLShortener {
      constructor(){
        this.baseUrl = getBaseUrl();
        this.urls = this.load();
        this.bind();
        this.renderList();
        this.tryRedirect(); // ?s=code or /?s=code
      }

      bind(){
        $('shortenBtn').onclick = ()=>this.create();
        $('urlInput').addEventListener('keydown', e=>{ if(e.key==='Enter') this.create(); });
        $('copyBtn').onclick = ()=>this.copy();
        $('exportBtn').onclick = ()=>this.export();
        $('importBtn').onclick = ()=>this.import();
        $('clearBtn').onclick = ()=>this.clearAll();
      }

      create(){
        const original = $('urlInput').value.trim();
        const err = $('errorMsg'); err.textContent='';
        if(!original){ err.textContent='URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'; return; }
        if(!isValidUrl(original)){ err.textContent='ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (ì˜ˆ: https://example.com)'; return; }

        const btn = $('shortenBtn'); btn.disabled=true; btn.textContent='ìƒì„± ì¤‘â€¦';

        // ì¤‘ë³µ í”¼í•´ì„œ ì½”ë“œ ìƒì„±
        let code;
        do{ code = randomCode(); } while (this.urls[code]);

        const info = { original, short: code, clicks: 0, created: new Date().toISOString() };
        this.urls[code] = info; this.save();

        $('urlInput').value='';
        this.showResult(code);
        this.renderList();

        btn.disabled=false; btn.textContent='ë‹¨ì¶• URL ë§Œë“¤ê¸°';
      }

      showResult(code){
        const short = `${this.baseUrl}?s=${encodeURIComponent(code)}`;
        $('shortUrl').textContent = short;
        $('result').classList.add('show');
        $('result').scrollIntoView({ behavior:'smooth', block:'nearest' });
      }

      async copy(){
        const t = $('shortUrl').textContent;
        const b = $('copyBtn');
        try { await navigator.clipboard.writeText(t); }
        catch {
          const ta=document.createElement('textarea'); ta.value=t; document.body.appendChild(ta);
          ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        }
        b.textContent='ë³µì‚¬ë¨!'; b.classList.add('copied');
        await sleep(1600); b.textContent='ë³µì‚¬'; b.classList.remove('copied');
      }

      renderList(){
        const box = $('urlList');
        const entries = Object.entries(this.urls)
          .sort(([,a],[,b])=> new Date(b.created)-new Date(a.created))
          .slice(0, 15);

        if(entries.length===0){
          box.innerHTML = '<p style="text-align:center;color:#999">ì•„ì§ ìƒì„±ëœ ë‹¨ì¶• URLì´ ì—†ìŠµë‹ˆë‹¤</p>';
          return;
        }
        box.innerHTML = entries.map(([code, data])=>{
          const short = `${this.baseUrl}?s=${encodeURIComponent(code)}`;
          return `
            <div class="url-item">
              <div class="clicks">${data.clicks} í´ë¦­</div>
              <div class="original" title="${data.original}">${truncate(data.original, 70)}</div>
              <div class="short"><a href="?s=${encodeURIComponent(code)}" target="_blank" style="text-decoration:none;color:inherit">${short}</a></div>
            </div>`;
        }).join('');
      }

      tryRedirect(){
        // ?s=CODE ì§€ì›
        const params = new URLSearchParams(location.search);
        const code = params.get('s');
        if(!code) return;

        const info = this.urls[code];
        if(!info){
          // ì¡´ì¬í•˜ì§€ ì•ŠìŒ
          document.body.innerHTML = `
            <div class="redirect-page" style="text-align:center;margin-top:100px">
              <div class="redirect-404" style="color:#dc3545;font-size:32px;margin-bottom:12px">404</div>
              <h1>í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h1>
              <p style="margin:16px 0">ìš”ì²­í•˜ì‹  ë‹¨ì¶• URL "<b>${code}</b>"ì´ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì´ ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
              <p style="color:#999">í™ˆì—ì„œ ë¨¼ì € ë‹¨ì¶• URLì„ ìƒì„±í•´ ì£¼ì„¸ìš”.</p>
              <a class="home-btn" href="${this.baseUrl}" style="color:#667eea;text-decoration:none;font-weight:700;font-size:18px;padding:10px 20px;border:2px solid #667eea;border-radius:6px;display:inline-block;margin-top:16px">í™ˆìœ¼ë¡œ</a>
            </div>`;
          return;
        }

        // ì¹´ìš´íŠ¸ ì¦ê°€ & ì €ì¥
        info.clicks++; this.save();

        const target = info.original;
        document.body.innerHTML = `
          <div class="redirect-page" style="text-align:center;margin-top:100px;font-family:sans-serif">
            <div class="redirect-loading" style="color:#28a745;font-size:24px;margin-bottom:10px">ğŸš€ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¤‘â€¦</div>
            <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
            <div class="redirect-url" style="color:#666;font-size:14px;word-break:break-all;margin:10px 0">ëŒ€ìƒ: ${target}</div>
            <p style="color:#999;font-size:12px;margin-top:14px">3ì´ˆ í›„ ìë™ ì´ë™í•©ë‹ˆë‹¤.</p>
          </div>`;
        setTimeout(()=> location.href = target, 3000);
      }

      export(){
        const blob = new Blob([JSON.stringify(this.urls,null,2)], {type:'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob); a.download = 'myshort-backup.json'; a.click();
        URL.revokeObjectURL(a.href);
      }

      import(){
        const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
        inp.onchange = () => {
          const f = inp.files?.[0]; if(!f) return;
          const rd = new FileReader();
          rd.onload = () => {
            try {
              const data = JSON.parse(String(rd.result));
              if (typeof data !== 'object' || Array.isArray(data)) throw new Error();
              this.urls = data; this.save(); this.renderList(); alert('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!');
            } catch { alert('JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”.'); }
          };
          rd.readAsText(f);
        };
        inp.click();
      }

      clearAll(){
        if(!confirm('ëª¨ë“  ë‹¨ì¶• URLì„ ì‚­ì œí• ê¹Œìš”?')) return;
        this.urls = {}; this.save(); this.renderList(); $('result').classList.remove('show');
      }

      save(){ try{ localStorage.setItem('shortUrls', JSON.stringify(this.urls)); }catch(e){ console.error(e); } }
      load(){ try{ const s=localStorage.getItem('shortUrls'); return s?JSON.parse(s):{} }catch{ return {} } }
    }

    document.addEventListener('DOMContentLoaded', ()=> new URLShortener());
  </script>
</body>
</html>
